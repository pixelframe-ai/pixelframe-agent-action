# PixelFrame Agent GitHub Action

Reusable GitHub Action that triggers the PixelFrame coding agent, applies the generated code changes, and manages the corresponding pull request lifecycle.

## Features
- Posts the PixelFrame payload to your agent backend.
- Applies file updates returned by the agent, commits them to a working branch, and pushes to the repository using the provided token.
- Opens or updates a pull request and optionally assigns reviewers or merges when requested by the agent.
- Exposes run metadata (`run-id`, `status`) to downstream workflow steps.

## Inputs
- `payload-file` (required): Path to the JSON payload supplied by PixelFrame during workflow execution.
- `token` (optional): GitHub token with write permissions. Defaults to `${{ github.token }}`.
- `merge-strategy` (optional): Fallback strategy to use when merging automatically (`merge`, `squash`, or `rebase`).
- `agent-provider` (optional): Override the provider identifier reported to the PixelFrame API.
- `pixelframe-base-url` (optional): Explicit base URL for the PixelFrame API (otherwise the action falls back to `PIXELFRAME_BASE_URL`).

## Outputs
- `run-id`: Identifier returned by the PixelFrame backend for the agent run (when available).
- `status`: Status string provided by the agent response.

## Required Secrets / Environment
- `PIXELFRAME_API_KEY`: Bearer token for authenticating against the PixelFrame backend.
- `PIXELFRAME_BASE_URL` (optional): Default base URL for the PixelFrame API when the payload does not provide a full agent endpoint.

## Payload Contract
PixelFrame supplies a payload JSON file to the workflow. At minimum it must contain the data required by your backend to initiate an agent run. The action additionally expects the response from the backend to include a plan describing repository operations, for example:

```json
{
  "runId": "2c9b92f3-3a9c-45e8-bf67-5c7f4ce2a2b9",
  "status": "completed",
  "plan": {
    "branch": "pixelframe/update-123",
    "baseBranch": "main",
    "commitMessage": "feat: apply PixelFrame suggestions",
    "files": [
      { "path": "src/example.ts", "contents": "// updated code" }
    ],
    "pullRequest": {
      "title": "Apply PixelFrame updates",
      "body": "This PR was generated by the PixelFrame agent.",
      "draft": false,
      "reviewers": {
        "users": ["octocat"],
        "teams": ["ecosystem/reviewers"]
      }
    }
  }
}
```

Fields are optional; the action only performs Git and GitHub operations when the corresponding data is present.

## Example Workflow

```yaml
name: PixelFrame Agent

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'

jobs:
  run-agent:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Download PixelFrame payload
        # Replace this step with however PixelFrame delivers the payload.
        run: |
          echo '{}' > payload.json

      - name: Run PixelFrame agent
        uses: pixelframe-ai/pixelframe-agent-action@v1
        with:
          payload-file: payload.json
        env:
          PIXELFRAME_API_KEY: ${{ secrets.PIXELFRAME_API_KEY }}
          PIXELFRAME_BASE_URL: ${{ vars.PIXELFRAME_BASE_URL }}
```

## Local Development
1. Update the source logic in `src/index.js`.
2. Regenerate the distributable: `npm run build`.
3. Commit both `src/index.js` and `dist/index.js`.

## Release Checklist
1. Commit all changes and push to GitHub.
2. Tag the release (`git tag v1.0.0 && git push --tags`).
3. Optionally move the `v1` tag to the latest stable commit.
4. Publish a GitHub release so workflows can reference `pixelframe-ai/pixelframe-agent-action@v1`.
